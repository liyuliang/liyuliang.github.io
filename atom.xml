<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Liyuliang&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://liyuliang.cc/"/>
  <updated>2021-06-14T14:02:02.291Z</updated>
  <id>https://liyuliang.cc/</id>
  
  <author>
    <name>Liyuliang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Filter Sensitive Info In Go</title>
    <link href="https://liyuliang.cc/2018/07/06/Filter-Sensitive-Info-In-Go/"/>
    <id>https://liyuliang.cc/2018/07/06/Filter-Sensitive-Info-In-Go/</id>
    <published>2018-07-06T15:04:01.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% cat /etc/issue</span><br><span class="line">Ubuntu 16.04.7 LTS \n \l</span><br><span class="line"></span><br><span class="line">% go version</span><br><span class="line">go version go1.14.6 linux/amd64</span><br></pre></td></tr></table></figure><a id="more"></a><p>在我们的项目开发过程中，无论是网站开发、app开发、小程序开发， 都离不开用户数据以及他们的敏感数据保护。<br>在接口数据返回前，我们都需要对特定的数据字段进行二次处理，通常做法是删除该字段或者新建一个安全的数据结构，把数据库内容复制到新的数据结构上。<br>今天我们来看看另一种做法.</p><p>像这里我们的用户表, Password 是不允许被接口返回的,更加不能被查看的<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type User struct &#123;</span><br><span class="line">Email    string `json:&quot;email&quot;`</span><br><span class="line">Password string `json:&quot;password&quot;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当接口/api/user/1 返回时，旧的做法是新建一个结构类型<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type ApiUser struct &#123;</span><br><span class="line">Email    string `json:&quot;email&quot;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这个数据类型会缺少属性<code>Password</code>, 然后把User的数据Copy到ApiUser中<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">u := User&#123;</span><br><span class="line">Email:    &quot;a@gmail.com&quot;,</span><br><span class="line">Password: &quot;This is A Password&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apiU := ApiUser&#123;&#125;</span><br><span class="line"></span><br><span class="line">copier.Copy(&amp;apiU, &amp;u)</span><br></pre></td></tr></table></figure></p><p>那么接下来我们就来介绍<code>json.Unmarshaler</code></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">type User struct &#123;</span><br><span class="line">Email    string `json:&quot;email&quot;`</span><br><span class="line">Password string `json:&quot;password&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (u User) MarshalJSON() ([]byte, error) &#123;</span><br><span class="line">type user User</span><br><span class="line">cn := user(u)</span><br><span class="line">cn.Password = &quot;[SECRET]&quot;</span><br><span class="line">return json.Marshal(cn)</span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">u := User&#123;</span><br><span class="line">Email:    &quot;a@gmail.com&quot;,</span><br><span class="line">Password: &quot;This is A Password&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b, _ := json.Marshal(u)</span><br><span class="line">println(string(b))        //&#123;&quot;email&quot;:&quot;a@gmail.com&quot;,&quot;password&quot;:&quot;[SECRET]&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OK，完成了json的处理，那如果是日志工具或者在开发过程debug log打印导致的敏感数据泄漏呢？<br>我们就需要实现<code>fmt.Stringer</code>这个接口类型了， 通常用在<code>log/fmt</code>等package中<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func (u User) String() string &#123;</span><br><span class="line">return &quot;[This Is Secret Data]&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">...</span><br><span class="line">fmt.Println(u)    // [This Is Secret Data]</span><br><span class="line">log.Println(u)    // 2018/07/06 23:10:02 [This Is Secret Data]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>那如果是http form request中的敏感数据保存进数据库, 怎么实现赋值给struct时实现字段加密呢？<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data := make(map[string]interface&#123;&#125;)</span><br><span class="line">data[&quot;email&quot;] = &quot;b@gmail.com&quot;</span><br><span class="line">data[&quot;password&quot;] = &quot;This is B Password&quot;</span><br><span class="line"></span><br><span class="line">b, _ = json.Marshal(data)</span><br><span class="line"></span><br><span class="line">u := User&#123;&#125;</span><br><span class="line">_ = json.Unmarshal(b, &amp;u)</span><br></pre></td></tr></table></figure></p><p>一般map数据绑定到struct，都会用到json.Unmarshal, 所以我们需要User也实现<code>UnmarshalJSON</code>的方法。注意，这里将使用指针方法实现<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func (u *User) UnmarshalJSON(b []byte) error &#123;</span><br><span class="line">type tmp User</span><br><span class="line">tmpUser := tmp(*u)</span><br><span class="line"></span><br><span class="line">_ = json.Unmarshal(b, &amp;tmpUser)</span><br><span class="line">tmpUser.Password = encrypty(tmpUser.Password)</span><br><span class="line">u.Email = tmpUser.Email</span><br><span class="line">u.Password = tmpUser.Password</span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>到这里， 方法就介绍完了，希望也能对你有帮助吧</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;% cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 16.04.7 LTS \n \l&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;% go version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go version go1.14.6 linux/amd64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="golang" scheme="https://liyuliang.cc/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Varnish For Wordpress</title>
    <link href="https://liyuliang.cc/2018/06/20/Varnish-For-Wordpress/"/>
    <id>https://liyuliang.cc/2018/06/20/Varnish-For-Wordpress/</id>
    <published>2018-06-20T09:41:57.000Z</published>
    <updated>2021-06-14T14:02:02.295Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/system-release</span><br><span class="line">CentOS Linux release 7.7.1908 (Core)</span><br></pre></td></tr></table></figure><a id="more"></a><p>Recently, in the cache test part, although W3 Total Cache is great, but the network request must go through PHP to get the records in the database, and it is limited by the database and hard disk.<br>There are some plugins that can achieve pseudo-staticization and improve a lot of speed.<br>But there are still many things that are limited.<br>Later, I wanted to say that I use Varnish, save it in php, and put the cache in memory.<br>So here is this record.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">vcl 4.0;</span><br><span class="line"></span><br><span class="line">backend default &#123;</span><br><span class="line">    .host = &quot;127.0.0.1&quot;;</span><br><span class="line">    .port = &quot;8080&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">acl purge &#123;</span><br><span class="line">    &quot;localhost&quot;;</span><br><span class="line">    &quot;127.0.0.1&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_recv &#123;</span><br><span class="line"></span><br><span class="line">    if (req.method == &quot;PURGE&quot;) &#123;</span><br><span class="line">        if (!client.ip ~ purge) &#123;</span><br><span class="line">            return(synth(405, &quot;Deny&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">        return (purge);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (req.http.Authorization || req.method == &quot;POST&quot;) &#123;</span><br><span class="line">        return (pass);</span><br><span class="line">    &#125;</span><br><span class="line">    if (req.url ~ &quot;(wp-login|wp-admin|feed)&quot; || req.url ~ &quot;preview=true&quot; || req.url ~ &quot;(xmlrpc.php|wp-cron.php)&quot;) &#123;</span><br><span class="line">        return (pass);</span><br><span class="line">    &#125;</span><br><span class="line">    if (req.url ~ &quot;\.(gif|jpg|jpeg|swf|ttf|css|js|flv|mp3|mp4|pdf|ico|png)(\?.*|)$&quot;) &#123;</span><br><span class="line">        unset req.http.cookie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (req.http.Cookie ~ &quot;wordpress_&quot; || req.http.Cookie ~ &quot;comment_&quot;) &#123;</span><br><span class="line">#        return (pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return (hash);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_pipe &#123;</span><br><span class="line">    return (pipe);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_pass &#123;</span><br><span class="line">    return (fetch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_hash &#123;</span><br><span class="line">     hash_data(req.url);</span><br><span class="line">     if (req.http.host) &#123;</span><br><span class="line">         hash_data(req.http.host);</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">         hash_data(server.ip);</span><br><span class="line">     &#125;</span><br><span class="line">    return (lookup);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_backend_response &#123;</span><br><span class="line"></span><br><span class="line">    if (bereq.url ~ &quot;\.(css|js|png|gif|jp(e?)g)|swf|ico&quot;) &#123;</span><br><span class="line">        unset beresp.http.cookie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (beresp.http.Set-Cookie &amp;&amp; bereq.url !~ &quot;^/wp-(login|admin)&quot;) &#123;</span><br><span class="line">        unset beresp.http.Set-Cookie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ( bereq.method == &quot;POST&quot; || bereq.http.Authorization ) &#123;</span><br><span class="line">        set beresp.uncacheable = true;</span><br><span class="line">        set beresp.ttl = 120s;</span><br><span class="line">        return (deliver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ( bereq.url ~ &quot;\?s=&quot; )&#123;</span><br><span class="line">        set beresp.uncacheable = true;</span><br><span class="line">        set beresp.ttl = 120s;</span><br><span class="line">        return (deliver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ( beresp.status != 200 ) &#123;</span><br><span class="line">        set beresp.uncacheable = true;</span><br><span class="line">        set beresp.ttl = 120s;</span><br><span class="line">        return (deliver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set beresp.ttl = 72h;</span><br><span class="line">    set beresp.grace = 30s;</span><br><span class="line"></span><br><span class="line">    return (deliver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_deliver &#123;</span><br><span class="line">    if (obj.hits &gt; 0) &#123;</span><br><span class="line">        set resp.http.X-cache = &quot;HIT&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        set resp.http.X-cache = &quot;Miss&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    unset resp.http.Via;</span><br><span class="line">    unset resp.http.X-Varnish;</span><br><span class="line">    set resp.http.X-Cache-Hits = obj.hits;</span><br><span class="line">    return (deliver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_init &#123;</span><br><span class="line">     return (ok);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub vcl_fini &#123;</span><br><span class="line">     return (ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/system-release&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CentOS Linux release 7.7.1908 (Core)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Wordpress" scheme="https://liyuliang.cc/tags/Wordpress/"/>
    
      <category term="Varnish" scheme="https://liyuliang.cc/tags/Varnish/"/>
    
  </entry>
  
  <entry>
    <title>How to find wordpress admin account</title>
    <link href="https://liyuliang.cc/2018/06/19/How-to-find-wordpress-admin-account/"/>
    <id>https://liyuliang.cc/2018/06/19/How-to-find-wordpress-admin-account/</id>
    <published>2018-06-19T05:06:44.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04 LTS</span><br></pre></td></tr></table></figure><a id="more"></a><p>Today, a friend found me. The employee responsible for maintaining the official website of his company left.<br>He did not record the Wordpress administrator account when he left. Can’t be reached in a short time.<br>My friend asked for my help, hoping to optimize the loading speed of Wordpress.<br>I searched for several plugins that can provide caching function, but it is very troublesome to enable and configure the plugin without logging in to the background without an administrator account.</p><p>Well,let’s try the function of recovering the password.</p><blockquote><p>“I don’t know what the account is”.<br>“We didn’t equip Wordpress with a mailbox”.</p></blockquote><p>-Careless boss said.</p><p>“Hmm .. bad things at this time”</p><p>Then let’s ask the database rudely.<br>Fortunately, WordPress “friendly” records the database connection method in <code>wp-config.php</code>.</p><p>Generally speaking, the administrator account of Wordpress is which ID is 1 or the first account of the table wp_users.<br>The password is encrypted with <code>MD5</code>, we only need to generate an <code>MD5</code> encrypted password to replace the original password.</p><p>But! After trying these, I found out that the first three accounts are not administrator accounts!<br>I think we should look for better way.</p><p>Finally, I found that Wordpress has a user level, and the level 10 is the administrator.<br>Find the <code>meta_key</code> attribute <code>wp_user_level</code> in table <code>wp_usermeta</code>. The <code>meta_value</code> value is 10. The corresponding <code>user_id</code> is a number, and this number is the administrator ID.</p><p>Then let’s take a look at this SQL.<br><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from wp_usermeta where meta_value = 10;</span><br><span class="line">+<span class="hljs-comment">----------+---------+---------------+------------+</span></span><br><span class="line">| umeta_id | user_id | meta_key      | meta_value |</span><br><span class="line">+<span class="hljs-comment">----------+---------+---------------+------------+</span></span><br><span class="line">|       98 |       8 | wp_user_level | 10         |</span><br><span class="line">+<span class="hljs-comment">----------+---------+---------------+------------+</span></span><br><span class="line">2 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p><p>Ok! I found them! Easily solve! </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 14.04 LTS&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Wordpress" scheme="https://liyuliang.cc/tags/Wordpress/"/>
    
  </entry>
  
  <entry>
    <title>Install Pagespeed For Nginx On Centos7</title>
    <link href="https://liyuliang.cc/2018/06/05/Install-Pagespeed-For-Nginx-On-Centos7/"/>
    <id>https://liyuliang.cc/2018/06/05/Install-Pagespeed-For-Nginx-On-Centos7/</id>
    <published>2018-06-05T09:55:21.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/system-release</span><br><span class="line">CentOS Linux release 7.7.1908 (Core)</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Install-Newest-Nginx-With-Pagespeed"><a href="#Install-Newest-Nginx-With-Pagespeed" class="headerlink" title="Install Newest Nginx With Pagespeed"></a>Install Newest Nginx With Pagespeed</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /root</span><br><span class="line">$ bash &lt;(curl -f -L -sS https://ngxpagespeed.com/install) --nginx-version latest</span><br></pre></td></tr></table></figure><blockquote><p>All press Enter</p></blockquote><p>Then</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd nginx-1.16.0</span><br><span class="line">$ ./configure  --user=www --group=www --prefix=/usr/local/nginx --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-threads --add-module=/root/incubator-pagespeed-ngx-latest-stable</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure><p>Give it a soft link</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx</span><br><span class="line">$ nginx -V</span><br></pre></td></tr></table></figure><h3 id="Setting-up-nginx-startup"><a href="#Setting-up-nginx-startup" class="headerlink" title="Setting up nginx startup"></a>Setting up nginx startup</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/init.d/nginx</span><br></pre></td></tr></table></figure><p>Here is the configuration file</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">#</span><br><span class="line"># nginx - this script starts and stops the nginx daemon</span><br><span class="line">#</span><br><span class="line"># chkconfig:   - 85 15</span><br><span class="line"># description:  NGINX is an HTTP(S) server, HTTP(S) reverse \</span><br><span class="line">#               proxy and IMAP/POP3 proxy server</span><br><span class="line"># processname: nginx</span><br><span class="line"># config:      /usr/local/nginx/conf/nginx.conf</span><br><span class="line"># config:      /etc/sysconfig/nginx</span><br><span class="line"># pidfile:     /usr/local/nginx/logs/nginx.pid</span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"># Source networking configuration.</span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"># Check that networking is up.</span><br><span class="line">[ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line">nginx=&quot;/usr/local/nginx/sbin/nginx&quot;</span><br><span class="line">prog=$(basename $nginx)</span><br><span class="line">NGINX_CONF_FILE=&quot;/usr/local/nginx/conf/nginx.conf&quot;</span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line">make_dirs() &#123;</span><br><span class="line">   # make required directories</span><br><span class="line">   user=`$nginx -V 2&gt;&amp;1 | grep &quot;configure arguments:&quot; | sed &apos;s/[^*]*--user=\([^ ]*\).*/\1/g&apos; -`</span><br><span class="line">   if [ -z &quot;`grep $user /etc/passwd`&quot; ]; then</span><br><span class="line">       useradd -M -s /bin/nologin $user</span><br><span class="line">   fi</span><br><span class="line">   options=`$nginx -V 2&gt;&amp;1 | grep &apos;configure arguments:&apos;`</span><br><span class="line">   for opt in $options; do</span><br><span class="line">       if [ `echo $opt | grep &apos;.*-temp-path&apos;` ]; then</span><br><span class="line">           value=`echo $opt | cut -d &quot;=&quot; -f 2`</span><br><span class="line">           if [ ! -d &quot;$value&quot; ]; then</span><br><span class="line">               # echo &quot;creating&quot; $value</span><br><span class="line">               mkdir -p $value &amp;&amp; chown -R $user $value</span><br><span class="line">           fi</span><br><span class="line">       fi</span><br><span class="line">   done</span><br><span class="line">&#125;</span><br><span class="line">start() &#123;</span><br><span class="line">    [ -x $nginx ] || exit 5</span><br><span class="line">    [ -f $NGINX_CONF_FILE ] || exit 6</span><br><span class="line">    make_dirs</span><br><span class="line">    echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">    daemon $nginx -c $NGINX_CONF_FILE</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">    killproc $prog -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line">restart() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line">reload() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line">    killproc $nginx -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line">force_reload() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line">configtest() &#123;</span><br><span class="line">  $nginx -t -c $NGINX_CONF_FILE</span><br><span class="line">&#125;</span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status $prog</span><br><span class="line">&#125;</span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        echo $&quot;Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;&quot;</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h3 id="Give-script-executable-permissions"><a href="#Give-script-executable-permissions" class="headerlink" title="Give script executable permissions"></a>Give script executable permissions</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod a+x /etc/init.d/nginx</span><br></pre></td></tr></table></figure><h3 id="Add-Nginx-service-to-chkconfig-management-list"><a href="#Add-Nginx-service-to-chkconfig-management-list" class="headerlink" title="Add Nginx service to chkconfig management list"></a>Add Nginx service to chkconfig management list</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ chkconfig --add /etc/init.d/nginx</span><br><span class="line">$ chkconfig nginx on</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /usr/local/nginx/pagespeed_temp</span><br><span class="line">$ mkdir -p /usr/local/nginx/site_enabled</span><br></pre></td></tr></table></figure><h3 id="Configure-pagespeed-for-your-web-application"><a href="#Configure-pagespeed-for-your-web-application" class="headerlink" title="Configure pagespeed for your web application"></a>Configure pagespeed for your web application</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">user  www;</span><br><span class="line"></span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    include       /usr/local/nginx/site_enabled/*.conf;</span><br><span class="line">    ...</span><br><span class="line">    server&#123;</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        pagespeed on;</span><br><span class="line">        pagespeed FileCachePath /usr/local/nginx/pagespeed_temp/;</span><br><span class="line"></span><br><span class="line">        location ~ &quot;\.pagespeed\.([a-z]\.)?[a-z]&#123;2&#125;\.[^.]&#123;10&#125;\.[^.]+&quot; &#123; add_header &quot;&quot; &quot;&quot;; &#125;</span><br><span class="line">        location ~ &quot;^/ngx_pagespeed_static/&quot; &#123; &#125;</span><br><span class="line">        location ~ &quot;^/ngx_pagespeed_beacon&quot; &#123; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Startup"><a href="#Startup" class="headerlink" title="Startup"></a>Startup</h1><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/system-release&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CentOS Linux release 7.7.1908 (Core)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Pagespeed" scheme="https://liyuliang.cc/tags/Pagespeed/"/>
    
      <category term="Nginx" scheme="https://liyuliang.cc/tags/Nginx/"/>
    
      <category term="Centos" scheme="https://liyuliang.cc/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>Disable Nginx logs completely</title>
    <link href="https://liyuliang.cc/2018/05/09/Disable-Nginx-logs-completely/"/>
    <id>https://liyuliang.cc/2018/05/09/Disable-Nginx-logs-completely/</id>
    <published>2018-05-09T05:06:44.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04 LTS</span><br></pre></td></tr></table></figure><a id="more"></a><p>Open the “nginx.conf” file (usually located : /etc/nginx folder) or the Nginx config file for a particular site, for which you wish to turn off nginx logs (usually located in : /etc/nginx/sites-available folder).</p><p>Find the line :<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log    /var/log/nginx/error.log;</span><br></pre></td></tr></table></figure></p><p>Some people simply change the line to the following :</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log    off;</span><br></pre></td></tr></table></figure><p>Please note that this will not stop the nginx logs from being created on the server.<br>This will just create the logs in : “/usr/share/nginx/off” file.</p><p>If you wish to turn off the Nginx error logs completely, you need to change the line to :</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log   /dev/null   crit;</span><br></pre></td></tr></table></figure><p>This will completely turn off the Nginx error logs on your server.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 14.04 LTS&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="nginx" scheme="https://liyuliang.cc/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>How To Change Tmux Prefix Keymap In Iterm2</title>
    <link href="https://liyuliang.cc/2018/04/03/How-To-Change-Tmux-Prefix-Keymap-In-Iterm2/"/>
    <id>https://liyuliang.cc/2018/04/03/How-To-Change-Tmux-Prefix-Keymap-In-Iterm2/</id>
    <published>2018-04-03T04:59:22.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers </span><br><span class="line">ProductName:Mac OS X</span><br><span class="line">ProductVersion:10.12.3</span><br><span class="line"></span><br><span class="line">$ tmux -V</span><br><span class="line">tmux 2.8</span><br><span class="line"></span><br><span class="line">$ Iterm2</span><br><span class="line">Build 3.2.5</span><br></pre></td></tr></table></figure><a id="more"></a><p>Default Prefix Key is <code>Ctrl</code> + <code>B</code>. I think it is too hard to press this combination button before next command.<br>Can i change the prefix key ?<br>According to the official document, the solution is inseparable from the <code>Ctrl</code> button. It means that <code>Ctrl</code> must be one of the prefix key.</p><p>But fortunately under mac, if you are using <code>Iterm</code> instead of system terminal, you can customize the key combination to mapping tmux ‘s prefix through by <code>Hex Code</code> </p><h3 id="Configuration-In-Item2"><a href="#Configuration-In-Item2" class="headerlink" title="Configuration In Item2:"></a>Configuration In Item2:</h3><blockquote><p>Preferences -&gt; Profiles -&gt; Keys</p></blockquote><h3 id="Add-A-new-Key-Mapping"><a href="#Add-A-new-Key-Mapping" class="headerlink" title="Add A new Key Mapping"></a>Add A new Key Mapping</h3><p>The Action choose <code>Send Hex Code</code><br>After recording the keyboard shortcut. You can set the mapping shortcut by hex code.<br>The key <code>Ctrl b</code> ‘s hex code is 0x02.<br>The next things becomes simpler.<br>Let me give an example. If you want to achieve the effect to mapping <code>Ctrl B</code> + <code>w</code>, you can entry the hex code <code>0x02 0x77</code> </p><p>Here i have search a example picture, you can compare it to get more information to build your own unique shortcut!<br><img src="/images/itemconfig.png" alt="Example Keys"></p><h3 id="More-Hex-Code"><a href="#More-Hex-Code" class="headerlink" title="More Hex Code"></a>More Hex Code</h3><p>You can check this <a href="https://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/command/reference/ffun_r/frf019.pdf" target="_blank" rel="noopener">ASCII Mapping Keyboard Table</a> to look for the hex code which you need.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sw_vers &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductName:	Mac OS X&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductVersion:	10.12.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ tmux -V&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tmux 2.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ Iterm2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Build 3.2.5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Mac" scheme="https://liyuliang.cc/tags/Mac/"/>
    
      <category term="Iterm" scheme="https://liyuliang.cc/tags/Iterm/"/>
    
      <category term="tmux" scheme="https://liyuliang.cc/tags/tmux/"/>
    
  </entry>
  
  <entry>
    <title>How to use &#39;time.After&#39; and &#39;default&#39; in Golang</title>
    <link href="https://liyuliang.cc/2018/03/26/How-to-use-time-After-and-default-in-Golang/"/>
    <id>https://liyuliang.cc/2018/03/26/How-to-use-time-After-and-default-in-Golang/</id>
    <published>2018-03-26T05:40:48.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers </span><br><span class="line">ProductName:Mac OS X</span><br><span class="line">ProductVersion:10.12.3</span><br><span class="line"></span><br><span class="line">$ go version</span><br><span class="line">go version go1.11.1 darwin/amd64</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Interrupted-by-signal"><a href="#Interrupted-by-signal" class="headerlink" title="Interrupted by signal"></a>Interrupted by signal</h3><p>In the process of using goroutine, <code>for{}</code> is often used to maintain some long-term work. We will control the exit by sending signals to control the goroutine.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select &#123;</span><br><span class="line">    case &lt;-ch: </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>When <code>ch channel</code> receives a signal, the <code>for{}</code> loop can be terminated by <code>break</code>.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">loop:</span><br><span class="line">    for &#123;</span><br><span class="line">        select &#123;</span><br><span class="line"></span><br><span class="line">        case &lt;-stopChan:</span><br><span class="line">            log.Println(&quot;Receive stop sign, stop loop. &quot;)</span><br><span class="line">            break loop</span><br><span class="line">        &#125;</span><br><span class="line">        case &lt;-ch2:</span><br><span class="line">            // do something </span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>When there are multiple <code>case</code>, <code>select</code> will randomly select a <code>case</code> to execute. At this time, <code>select</code> will block, until that the selected <code>case</code> is finished, and other <code>case</code> will not be executed.<br>But it’s easy to see the code in the selected <code>case</code> run for a long time, which seriously affects the execution of other <code>case</code>. This time you need to have timeout logic.</p><h3 id="Timeout-interrupt-loop"><a href="#Timeout-interrupt-loop" class="headerlink" title="Timeout interrupt loop"></a>Timeout interrupt loop</h3><p>In some scenarios, the loop should be time controlled. For example, in one of the cases, the network request timed out.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for &#123;</span><br><span class="line">       select &#123;</span><br><span class="line">       case &lt;-ch:</span><br><span class="line">           // http get timeout</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>Of course, you can also add a timeout attribute to the http request to ensure the timeliness of the network request. But here we use <code>time.After</code> to complete it.<br>First look at its structure<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// After waits for the duration to elapse and then sends the current time</span><br><span class="line">// on the returned channel.</span><br><span class="line">// It is equivalent to NewTimer(d).C.</span><br><span class="line">// The underlying Timer is not recovered by the garbage collector</span><br><span class="line">// until the timer fires. If efficiency is a concern, use NewTimer</span><br><span class="line">// instead and call Timer.Stop if the timer is no longer needed.</span><br><span class="line">func After(d Duration) &lt;-chan Time &#123;</span><br><span class="line">return NewTimer(d).C</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>This function will return a <code>channel</code>, which is exactly what <code>select{}</code> <code>case</code> needs.<br><code>time.After()</code> returns a channel message of type Time.<br>Based on this function, it is equivalent to the implementation of the timer, and is <code>non-blocking</code>.</p><p>Then the code should look like this:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">loop:</span><br><span class="line">    for &#123;</span><br><span class="line">    select &#123;</span><br><span class="line">            case &lt;-time.After(60 * time.Second):</span><br><span class="line">                log.Println(&quot;Time to stop. &quot;)</span><br><span class="line">                break loop</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>Exiting the loop after 60 seconds, it looks very simple, right?</p><h3 id="‘time-After’-and-‘default’-used-together"><a href="#‘time-After’-and-‘default’-used-together" class="headerlink" title="‘time.After’ and ‘default’ used together"></a>‘time.After’ and ‘default’ used together</h3><p>In <code>select{}</code>, not only <code>case</code>, but also a <code>default</code> keyword.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select &#123;</span><br><span class="line">    default:</span><br><span class="line">        // do default thing</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Go back to the previous example, if the limit loop is executed for up to 1 minute.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">loop:</span><br><span class="line">    for &#123;</span><br><span class="line">           select &#123;</span><br><span class="line">           case &lt;-ch1:</span><br><span class="line">               // do something 1</span><br><span class="line">           case &lt;-ch2:</span><br><span class="line">               // do something 2</span><br><span class="line">               </span><br><span class="line">           case &lt;-time.After(60 * time.Second):</span><br><span class="line">               log.Println(&quot;Time %d to stop. &quot;)</span><br><span class="line">               break loop</span><br><span class="line">                                   </span><br><span class="line">           default:</span><br><span class="line">               // do default thing</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>The code doesn’t seem to have any problems, but when executed, it will be found that the loop will not be aborted!<br><code>case &lt;-time.After(60 * time.Second):</code> has no work!<br>Why?</p><p>We can see inside the <code>time.After</code> function, which is actually return a new timer channel.<br>In the code above, each time you execute <code>time.After(60 * time.Second)</code> you create a new timer channel.<br>There’s no way the select statement can remember the channel it selected on in the previous iteration.</p><p>Now that you know the reason, then the next step is how to update these code.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">timeout := time.After(60 * time.Second)</span><br><span class="line">loop:</span><br><span class="line">     for &#123;</span><br><span class="line">            select &#123;</span><br><span class="line">            case &lt;-ch1:</span><br><span class="line">                // do something 1</span><br><span class="line">            case &lt;-ch2:</span><br><span class="line">                // do something 2</span><br><span class="line">                </span><br><span class="line">            case &lt;-timeout:</span><br><span class="line">                log.Println(&quot;Time %d to stop. &quot;)</span><br><span class="line">                break loop</span><br><span class="line">                                    </span><br><span class="line">            default:</span><br><span class="line">                // do default thing</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>Very simple, right?<br><code>select</code> default is blocked, define a timer type channel outside the loop, this time <code>select{}</code> is also fair to select one of the channel to execute.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sw_vers &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductName:	Mac OS X&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductVersion:	10.12.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ go version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go version go1.11.1 darwin/amd64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="golang" scheme="https://liyuliang.cc/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>How to build an IDE with Vim</title>
    <link href="https://liyuliang.cc/2018/03/11/How-to-build-an-IDE-with-Vim/"/>
    <id>https://liyuliang.cc/2018/03/11/How-to-build-an-IDE-with-Vim/</id>
    <published>2018-03-11T08:22:11.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04 LTS</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="My-computer-develop-environment-1"><a href="#My-computer-develop-environment-1" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04 LTS</span><br><span class="line"></span><br><span class="line">$ tmux -V</span><br><span class="line">tmux 2.8</span><br><span class="line"></span><br><span class="line">$ Iterm2</span><br><span class="line">Build 3.2.5</span><br></pre></td></tr></table></figure><!-- more --><h3 id="Install-Vim-8-0"><a href="#Install-Vim-8-0" class="headerlink" title="Install Vim 8.0:"></a>Install Vim 8.0:</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ add-apt-repository ppa:jonathonf/vim</span><br><span class="line">$ apt update</span><br><span class="line">$ apt-get install -y vim</span><br></pre></td></tr></table></figure><p>Maybe you will meet this problem<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash: add-apt-repository: command not found</span><br></pre></td></tr></table></figure></p><p>Then try this command<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt install software-properties-common</span><br></pre></td></tr></table></figure></p><h3 id="New-package-manage-directory"><a href="#New-package-manage-directory" class="headerlink" title="New package manage directory"></a>New package manage directory</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ~/.vim/bundle/</span><br></pre></td></tr></table></figure><h3 id="Install-git-and-clone-vim-package-manage"><a href="#Install-git-and-clone-vim-package-manage" class="headerlink" title="Install git and clone vim package manage"></a>Install git and clone vim package manage</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install -y git</span><br><span class="line">$ git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim</span><br></pre></td></tr></table></figure><h3 id="Create-vim-config-file"><a href="#Create-vim-config-file" class="headerlink" title="Create vim config file"></a>Create vim config file</h3><figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">$</span> <span class="hljs-string">vim</span> <span class="hljs-string">~/.vimrc</span></span><br></pre></td></tr></table></figure><h3 id="Copy-my-config"><a href="#Copy-my-config" class="headerlink" title="Copy my config"></a>Copy my config</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">set encoding=utf-8</span><br><span class="line">&quot; 定义快捷键的前缀，即&lt;Leader&gt;</span><br><span class="line">let mapleader=&quot;;&quot;</span><br><span class="line">&quot; 主题</span><br><span class="line">colorscheme default</span><br><span class="line">let g:Powerline_colorscheme=&apos;solarized256&apos;</span><br><span class="line"></span><br><span class="line">&quot; 设置 gvim 显示字体</span><br><span class="line">set guifont=YaHei\ Consolas\ Hybrid\ 11.5</span><br><span class="line"></span><br><span class="line">&quot; 总是显示状态栏</span><br><span class="line">set laststatus=2</span><br><span class="line">&quot; 显示光标当前位置</span><br><span class="line">set ruler</span><br><span class="line">&quot; 开启行号显示</span><br><span class="line">set number</span><br><span class="line">&quot; 高亮显示当前行/列</span><br><span class="line">set cursorline</span><br><span class="line">&quot;set cursorcolumn</span><br><span class="line"></span><br><span class="line">&quot; 高亮显示搜索结果</span><br><span class="line">set hlsearch</span><br><span class="line"></span><br><span class="line">&quot; 禁止光标闪烁</span><br><span class="line">set gcr=a:block-blinkon0</span><br><span class="line">&quot; 禁止显示滚动条</span><br><span class="line">set guioptions-=l</span><br><span class="line">set guioptions-=L</span><br><span class="line">set guioptions-=r</span><br><span class="line">set guioptions-=R</span><br><span class="line">&quot; 禁止显示菜单和工具条</span><br><span class="line">set guioptions-=m</span><br><span class="line">set guioptions-=T</span><br><span class="line"></span><br><span class="line">&quot; 基于缩进或语法进行代码折叠</span><br><span class="line">&quot; set foldmethod=indent</span><br><span class="line">set foldmethod=syntax</span><br><span class="line">&quot; 启动 vim 时关闭折叠代码</span><br><span class="line">set nofoldenable</span><br><span class="line">&quot; 禁止折行</span><br><span class="line">set nowrap</span><br><span class="line"></span><br><span class="line">&quot; 定义快捷键到行首和行尾</span><br><span class="line">nmap LB 0</span><br><span class="line">nmap LE $</span><br><span class="line">&quot; 设置快捷键将选中文本块复制至系统剪贴板</span><br><span class="line">vnoremap &lt;Leader&gt;y &quot;+y</span><br><span class="line">&quot; 设置快捷键将系统剪贴板内容粘贴至 vim</span><br><span class="line">nmap &lt;Leader&gt;p &quot;+p</span><br><span class="line">&quot; 定义快捷键关闭当前分割窗口</span><br><span class="line">nmap &lt;Leader&gt;q :q&lt;CR&gt;</span><br><span class="line">&quot; 定义快捷键保存当前窗口内容</span><br><span class="line">nmap &lt;Leader&gt;w :w&lt;CR&gt;</span><br><span class="line">&quot; 定义快捷键保存所有窗口内容并退出 vim</span><br><span class="line">nmap &lt;Leader&gt;WQ :wa&lt;CR&gt;:q&lt;CR&gt;</span><br><span class="line">&quot; 不做任何保存，直接退出 vim</span><br><span class="line">nmap &lt;Leader&gt;Q :qa!&lt;CR&gt;</span><br><span class="line">&quot; 依次遍历子窗口</span><br><span class="line">nnoremap nw &lt;C-W&gt;&lt;C-W&gt;</span><br><span class="line">&quot; 跳转至右方的窗口</span><br><span class="line">nnoremap &lt;Leader&gt;lw &lt;C-W&gt;l</span><br><span class="line">&quot; 跳转至左方的窗口</span><br><span class="line">nnoremap &lt;Leader&gt;hw &lt;C-W&gt;h</span><br><span class="line">&quot; 跳转至上方的子窗口</span><br><span class="line">nnoremap &lt;Leader&gt;kw &lt;C-W&gt;k</span><br><span class="line">&quot; 跳转至下方的子窗口</span><br><span class="line">nnoremap &lt;Leader&gt;jw &lt;C-W&gt;j</span><br><span class="line">&quot; 定义快捷键在结对符之间跳转</span><br><span class="line">nmap &lt;Leader&gt;M %</span><br><span class="line"></span><br><span class="line">&quot; 开启实时搜索功能</span><br><span class="line">set incsearch</span><br><span class="line">&quot; 搜索时大小写不敏感</span><br><span class="line">set ignorecase</span><br><span class="line">&quot; 关闭兼容模式</span><br><span class="line">set nocompatible</span><br><span class="line">&quot; vim 自身命令行模式智能补全</span><br><span class="line">set wildmenu</span><br><span class="line"></span><br><span class="line">&quot; vundle 环境设置</span><br><span class="line">filetype off</span><br><span class="line">&quot; 开启语法高亮功能</span><br><span class="line">syntax enable</span><br><span class="line">&quot; 允许用指定语法高亮配色方案替换默认方案</span><br><span class="line">syntax on</span><br><span class="line">&quot; 自适应不同语言的智能缩进</span><br><span class="line">&quot;filetype indent on</span><br><span class="line">&quot; 将制表符扩展为空格</span><br><span class="line">set expandtab</span><br><span class="line">&quot; 设置编辑时制表符占用空格数</span><br><span class="line">set tabstop=4</span><br><span class="line">&quot; &quot; 设置格式化时制表符占用空格数</span><br><span class="line">set shiftwidth=4</span><br><span class="line">&quot; 让 vim 把连续数量的空格视为一个制表符</span><br><span class="line">set softtabstop=4</span><br><span class="line"></span><br><span class="line">&quot; 随 vim 自启动</span><br><span class="line">let g:indent_guides_enable_on_vim_startup=1</span><br><span class="line">&quot; 从第二层开始可视化显示缩进</span><br><span class="line">let g:indent_guides_start_level=2</span><br><span class="line">&quot; 色块宽度</span><br><span class="line">let g:indent_guides_guide_size=1</span><br><span class="line">&quot; 快捷键 i 开/关缩进可视化</span><br><span class="line">:nmap &lt;silent&gt; &lt;Leader&gt;i &lt;Plug&gt;IndentGuidesToggle</span><br><span class="line"></span><br><span class="line">set rtp+=~/.vim/bundle/Vundle.vim</span><br><span class="line">&quot; vundle 管理的插件列表必须位于 vundle#begin() 和 vundle#end() 之间</span><br><span class="line">call vundle#begin()</span><br><span class="line">Plugin &apos;VundleVim/Vundle.vim&apos;</span><br><span class="line">Plugin &apos;altercation/vim-colors-solarized&apos;</span><br><span class="line">Plugin &apos;tomasr/molokai&apos;</span><br><span class="line">Plugin &apos;vim-scripts/phd&apos;</span><br><span class="line">Plugin &apos;Lokaltog/vim-powerline&apos;</span><br><span class="line">Plugin &apos;octol/vim-cpp-enhanced-highlight&apos;</span><br><span class="line">Plugin &apos;nathanaelkane/vim-indent-guides&apos;</span><br><span class="line">Plugin &apos;derekwyatt/vim-fswitch&apos;</span><br><span class="line">Plugin &apos;kshenoy/vim-signature&apos;</span><br><span class="line">Plugin &apos;vim-scripts/BOOKMARKS--Mark-and-Highlight-Full-Lines&apos;</span><br><span class="line">Plugin &apos;majutsushi/tagbar&apos;</span><br><span class="line">Plugin &apos;vim-scripts/indexer.tar.gz&apos;</span><br><span class="line">Plugin &apos;vim-scripts/DfrankUtil&apos;</span><br><span class="line">Plugin &apos;vim-scripts/vimprj&apos;</span><br><span class="line">Plugin &apos;dyng/ctrlsf.vim&apos;</span><br><span class="line">Plugin &apos;terryma/vim-multiple-cursors&apos;</span><br><span class="line">Plugin &apos;scrooloose/nerdcommenter&apos;</span><br><span class="line">Plugin &apos;vim-scripts/DrawIt&apos;</span><br><span class="line">Plugin &apos;SirVer/ultisnips&apos;</span><br><span class="line">Plugin &apos;Valloric/YouCompleteMe&apos;</span><br><span class="line">Plugin &apos;derekwyatt/vim-protodef&apos;</span><br><span class="line">Plugin &apos;scrooloose/nerdtree&apos;</span><br><span class="line">Plugin &apos;fholgado/minibufexpl.vim&apos;</span><br><span class="line">Plugin &apos;gcmt/wildfire.vim&apos;</span><br><span class="line">Plugin &apos;sjl/gundo.vim&apos;</span><br><span class="line">Plugin &apos;Lokaltog/vim-easymotion&apos;</span><br><span class="line">Plugin &apos;suan/vim-instant-markdown&apos;</span><br><span class="line">Plugin &apos;lilydjwg/fcitx.vim&apos;</span><br><span class="line">Plugin &apos;fatih/vim-go&apos;</span><br><span class="line">&quot; 插件列表结束</span><br><span class="line">call vundle#end()</span><br><span class="line"></span><br><span class="line">&quot; 将外部命令 wmctrl 控制窗口最大化的命令行参数封装成一个 vim 的函数</span><br><span class="line">fun! ToggleFullscreen()</span><br><span class="line">call system(&quot;wmctrl -ir &quot; . v:windowid . &quot; -b toggle,fullscreen&quot;)</span><br><span class="line">endf</span><br><span class="line">&quot; 全屏开/关快捷键</span><br><span class="line">map &lt;silent&gt; &lt;F11&gt; :call ToggleFullscreen()&lt;CR&gt;</span><br><span class="line">&quot; 启动 vim 时自动全屏</span><br><span class="line">autocmd VimEnter * call ToggleFullscreen()</span><br><span class="line">&quot; 让配置变更立即生效</span><br><span class="line">autocmd BufWritePost $MYVIMRC source $MYVIMRC</span><br><span class="line"></span><br><span class="line">&quot;</span><br><span class="line">&quot; NERDTree</span><br><span class="line">map &lt;F10&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">autocmd VimEnter * NERDTree</span><br><span class="line">&quot; Jump to the main window.</span><br><span class="line">autocmd VimEnter * wincmd p</span><br><span class="line">&quot; </span><br><span class="line">let NERDTreeShowHidden=1</span><br><span class="line"></span><br><span class="line">&quot; Auto exit NERDTree if no edit file</span><br><span class="line">autocmd BufEnter * if (winnr(&quot;$&quot;) == 1 &amp;&amp; exists(&quot;b:NERDTree&quot;) &amp;&amp; b:NERDTree.isTabTree()) | q | endif</span><br><span class="line">autocmd BufEnter * if 0 == len(filter(range(1, winnr(&apos;$&apos;)), &apos;empty(getbufvar(winbufnr(v:val), &quot;&amp;bt&quot;))&apos;)) | qa! | endif</span><br></pre></td></tr></table></figure><p>Then press button <code>Esc</code> and input <code>:PluginInstall</code>. You can see the process of vim plugin install.</p><h3 id="Maybe-you-will-get-some-faults-i-have-met-i-will-share-my-solution-here"><a href="#Maybe-you-will-get-some-faults-i-have-met-i-will-share-my-solution-here" class="headerlink" title="Maybe you will get some faults i have met, i will share my solution here."></a>Maybe you will get some faults i have met, i will share my solution here.</h3><blockquote><p>Indexer error: Exuberant Ctags not found in PATH. You need to install Ctags to make Indexer work.</p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install exuberant-ctags</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>YouCompleteMe unavailable no module named ycmd</p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.vim/bundle/YouCompleteMe/</span><br><span class="line">$ git submodule update --init --recursive</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>The ycmd server SHUT DOWN (restart with ‘:YcmRestartServer’). …M before using it. Follow the instructions in the documentation</p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.vim/bundle/YouCompleteMe</span><br><span class="line">$ python install.py</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>ERROR: Unable to find executable ‘cmake’. CMake is required to build ycmd</p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install -y cmake</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>ERROR: Python headers are missing in /usr/include/python2.7.</p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install -y python3-dev python3</span><br><span class="line">$ python3 install.py --clang-completer</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>No CMAKE_CXX_COMPILER could be found.</p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install -y gcc g++</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>Error detected while processing function <snr>15_IndentGuidesEnable[1]..indent_guides#enable[8]..indent_guides#init_script_vars[7]..indent_guides#capture_highlight:</snr></p></blockquote><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.vimrc</span><br></pre></td></tr></table></figure><p>Add <code>colorscheme default</code></p><p><br></p><blockquote><p>Could NOT find PythonLibs (missing: PYTHON_INCLUDE_DIRS) (found suitable version “3.4.3”, minimum required is “3.4”)</p></blockquote><p>You should upgrade you cmake which default version is 2.8 by <code>apt-get install -y cmake</code><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ add-apt-repository ppa:george-edison55/cmake-3.x</span><br><span class="line">$ apt-get update</span><br><span class="line">$ apt-get instal -y cmake</span><br></pre></td></tr></table></figure></p><p><br></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 14.04 LTS&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
      <category term="Vim" scheme="https://liyuliang.cc/tags/Vim/"/>
    
  </entry>
  
  <entry>
    <title>Omitmepty in Golang</title>
    <link href="https://liyuliang.cc/2018/03/08/Omitmepty-in-Golang/"/>
    <id>https://liyuliang.cc/2018/03/08/Omitmepty-in-Golang/</id>
    <published>2018-03-08T08:00:53.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers </span><br><span class="line">ProductName:    Mac OS X</span><br><span class="line">ProductVersion: 10.12.6</span><br><span class="line">BuildVersion:   16G29</span><br><span class="line"></span><br><span class="line">$ go version</span><br><span class="line">go version go1.8.3 darwin/amd64</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Omitempty-Behavior"><a href="#Omitempty-Behavior" class="headerlink" title="Omitempty Behavior"></a>Omitempty Behavior</h3><p>We often use <code>json</code> to serialize an object. In some scenarios, we only need to pass a property with a value. At this time we will use the omitempty property.</p><p>Read the official documentation for the encoding/json package and we will find a description of the omitempty behavior:</p><blockquote><p>Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless</p><p>the field’s tag is “-“, or<br>the field is empty and its tag specifies the “omitempty” option.<br>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero. The object’s default key string is the struct field name but can be specified in the struct field’s tag value. The “json” key in the struct field’s tag value is the key name, followed by an optional comma and options. Examples:</p></blockquote><p>The role of omitempty is to ignore this field when serializing JSON when the value of a field is empty.</p><p>What needs to be noted here is the definition of empty.</p><blockquote><p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.</p></blockquote><p>A simple example will help better understand<br><figure class="highlight golang hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> (</span><br><span class="line"><span class="hljs-string">"encoding/json"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">type</span> people <span class="hljs-keyword">struct</span> &#123;</span><br><span class="line">Name  <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"name"`</span></span><br><span class="line">AccountBalance <span class="hljs-keyword">float32</span> <span class="hljs-string">`json:"balance"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">p := <span class="hljs-built_in">new</span>(people)</span><br><span class="line">p.Name = <span class="hljs-string">"liyuliang"</span></span><br><span class="line"></span><br><span class="line">json,_ := json.Marshal(p)</span><br><span class="line"><span class="hljs-built_in">println</span>(<span class="hljs-keyword">string</span>(json))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>The result is that my account balance is 0.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;liyuliang&quot;,&quot;money&quot;:0&#125;</span><br></pre></td></tr></table></figure></p><p>When the property AccountBalance is added with omitempty<br><figure class="highlight golang hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">type</span> people <span class="hljs-keyword">struct</span> &#123;</span><br><span class="line">Name  <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"name"`</span></span><br><span class="line">Money <span class="hljs-keyword">float32</span> <span class="hljs-string">`json:"money,omitempty"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>I don’t even have an account!!<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;liyuliang&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>What a impressive property! Isn’t it?</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sw_vers &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductName:    Mac OS X&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductVersion: 10.12.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BuildVersion:   16G29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ go version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go version go1.8.3 darwin/amd64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="golang" scheme="https://liyuliang.cc/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Golang meet &#39;float64bits redeclared in this block&#39;</title>
    <link href="https://liyuliang.cc/2018/02/22/Golang-meet-float64bits-redeclared-in-this-block/"/>
    <id>https://liyuliang.cc/2018/02/22/Golang-meet-float64bits-redeclared-in-this-block/</id>
    <published>2018-02-22T10:53:54.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04 LTS</span><br><span class="line"></span><br><span class="line">$ go version</span><br><span class="line">go version go1.8 linux/amd64</span><br></pre></td></tr></table></figure><a id="more"></a><p>I have meet this error <code>usr/local/go/src/runtime/float.go:45: float64bits redeclared in this block</code><br>after update golang version from 1.8 to 1.9</p><p>Don’t worry, delete the go directory and re-install golang, problem will be fixed.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rm -rf /usr/local/go</span><br></pre></td></tr></table></figure></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s https://storage.googleapis.com/golang/go$&#123;GO_VERSION&#125;.linux-amd64.tar.gz | tar -v -C /usr/local -xz</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 14.04 LTS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ go version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go version go1.8 linux/amd64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="golang" scheme="https://liyuliang.cc/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>How to push multi repositories in same project</title>
    <link href="https://liyuliang.cc/2018/02/11/How-to-push-multi-repositories-in-same-project/"/>
    <id>https://liyuliang.cc/2018/02/11/How-to-push-multi-repositories-in-same-project/</id>
    <published>2018-02-11T05:50:39.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers</span><br><span class="line">ProductName:Mac OS X</span><br><span class="line">ProductVersion:10.12.3</span><br><span class="line">BuildVersion:16D30</span><br><span class="line"></span><br><span class="line">$ git --version</span><br><span class="line">git version 2.18.0</span><br></pre></td></tr></table></figure><a id="more"></a><p>I recently created a outsourcing project that needs to submit the project code to empolyer’s github repository,<br>But i want to save the project in my private repository at the same time, so i thick i can submit it to two repositories<br>at the same time when i push the git.<br>Here is my personal code repository <a href="https://gitee.com/" target="_blank" rel="noopener"><code>gitee</code></a>.</p><h3 id="The-first-step-create-a-new-repository"><a href="#The-first-step-create-a-new-repository" class="headerlink" title="The first step, create a new repository"></a>The first step, create a new repository</h3><p>It named <code>https://gitee.com/liyuliang/xxxx</code><br>Be careful not to check the option <code>Use Readme file to initialize this project</code> (使用Readme文件初始化这个项目)<br>The first time i checked this option, i got an error when git pushing </p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">To gitee.com:liyuliang/xxxx.git</span><br><span class="line"> ! [rejected]        master -&gt; master (fetch first)</span><br><span class="line">error: failed to push some refs to &apos;git@gitee.com:liyuliang/xxxx.git&apos;</span><br><span class="line">hint: Updates were rejected because the remote contains work that you do</span><br><span class="line">hint: not have locally. This is usually caused by another repository pushing</span><br><span class="line">hint: to the same ref. You may want to first integrate the remote changes</span><br><span class="line">hint: (e.g., &apos;git pull ...&apos;) before pushing again.</span><br><span class="line">hint: See the &apos;Note about fast-forwards&apos; in &apos;git push --help&apos; for details.</span><br></pre></td></tr></table></figure><h3 id="Second-Add-a-git-repository-in-your-project"><a href="#Second-Add-a-git-repository-in-your-project" class="headerlink" title="Second, Add a git repository in your project"></a>Second, Add a git repository in your project</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote set-url --add origin git@gitee.com:liyuliang/xxxx.git</span><br></pre></td></tr></table></figure><p>The project git config file looks like this<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/config </span><br><span class="line">[core]</span><br><span class="line">repositoryformatversion = 0</span><br><span class="line">filemode = true</span><br><span class="line">bare = false</span><br><span class="line">logallrefupdates = true</span><br><span class="line">ignorecase = true</span><br><span class="line">precomposeunicode = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">url = git@github:liyuliang/xxxx.git</span><br><span class="line">url = git@gitee.com:liyuliang/xxxx.git</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">remote = origin</span><br><span class="line">merge = refs/heads/master</span><br></pre></td></tr></table></figure></p><h3 id="The-Last-push-your-code-to-all-your-repositories"><a href="#The-Last-push-your-code-to-all-your-repositories" class="headerlink" title="The Last, push your code to all your repositories"></a>The Last, push your code to all your repositories</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push --all</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sw_vers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductName:	Mac OS X&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductVersion:	10.12.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BuildVersion:	16D30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ git --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git version 2.18.0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="git" scheme="https://liyuliang.cc/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>How to upload a picture url&#39;s content by form POST without local storage in Golang</title>
    <link href="https://liyuliang.cc/2018/02/03/How-to-upload-a-picture-url-s-content-by-form-POST-without-local-storage-in-Golang/"/>
    <id>https://liyuliang.cc/2018/02/03/How-to-upload-a-picture-url-s-content-by-form-POST-without-local-storage-in-Golang/</id>
    <published>2018-02-03T13:43:25.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-environment"><a href="#Server-environment" class="headerlink" title="Server environment"></a>Server environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">  Ubuntu 16.04 LTS</span><br><span class="line"></span><br><span class="line"># go version</span><br><span class="line">  go version go1.8.4 linux/amd64</span><br></pre></td></tr></table></figure><a id="more"></a><p>Recently, i want to download a few pictures as my souvenirs, but these pictures all comes from other people’s website link.<br>And i have a personal image server which have form post api.<br>So this program will finished these steps in this tutorial with a few line code.</p><ul><li>Download a picture and save in memory temporary as byte buffer</li><li>Generate a post form and include picture ‘s information and content</li><li>Http request to image server</li></ul><p><code>The key is to set a new multipart.Writer</code></p><h3 id="Download-a-picture"><a href="#Download-a-picture" class="headerlink" title="Download a picture"></a>Download a picture</h3><p>It ‘s so sample to do this.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp, err := req.Get(imageUrl)</span><br></pre></td></tr></table></figure><h3 id="Init-a-empty-byte-buffer"><a href="#Init-a-empty-byte-buffer" class="headerlink" title="Init a empty byte buffer"></a>Init a empty byte buffer</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body = &amp;bytes.Buffer&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="Init-a-writer"><a href="#Init-a-writer" class="headerlink" title="Init a writer"></a>Init a writer</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writer := multipart.NewWriter(body)</span><br></pre></td></tr></table></figure><p>The <code>mime/multipart</code> package hides all the complexity of creating a multipart request.</p><h3 id="Create-a-writer-form-and-init-a-fired-for-picture"><a href="#Create-a-writer-form-and-init-a-fired-for-picture" class="headerlink" title="Create a writer form and init a fired for picture"></a>Create a writer form and init a fired for picture</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writerField, err := writer.CreateFormField(&quot;file&quot;)</span><br></pre></td></tr></table></figure><p>Create a part for the file form entry with the name of the file param and the name of the file.</p><h3 id="Translate-the-picture-as-byte-buffer"><a href="#Translate-the-picture-as-byte-buffer" class="headerlink" title="Translate the picture as byte buffer"></a>Translate the picture as byte buffer</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_, err = io.Copy(writerField, resp.Response().Body)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return body, &quot;&quot;, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">writer.Close()</span><br></pre></td></tr></table></figure><p>We need to add the content of the file to the file part, we use the <code>io.Copy()</code> to do so.<br>The <code>multipart.Writer</code> takes care of setting the boundary and formatting the form data for us, nice isn’t it?!</p><ul><li>Don’t forget to close our writer.</li></ul><h3 id="One-last-thing-before-post-form-request-you-should-know-the-form-content-type"><a href="#One-last-thing-before-post-form-request-you-should-know-the-form-content-type" class="headerlink" title="One last thing before post form request, you should know the form content type"></a>One last thing before post form request, you should know the form content type</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contentType := writer.FormDataContentType()</span><br></pre></td></tr></table></figure><h3 id="New-a-Post-form-request"><a href="#New-a-Post-form-request" class="headerlink" title="New a Post form request"></a>New a Post form request</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request, err := http.NewRequest(&quot;POST&quot;, apiUrl, body)</span><br><span class="line">request.Header.Set(&quot;Content-Type&quot;, contentType)</span><br></pre></td></tr></table></figure><h3 id="Send-this-request"><a href="#Send-this-request" class="headerlink" title="Send this request"></a>Send this request</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line">response, err := client.Do(request)</span><br></pre></td></tr></table></figure><p>This tutorial is written based on <code>Static file upload</code>.<br>Hopefully this example will be helpful to some of you.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-environment&quot;&gt;&lt;a href=&quot;#Server-environment&quot; class=&quot;headerlink&quot; title=&quot;Server environment&quot;&gt;&lt;/a&gt;Server environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Ubuntu 16.04 LTS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# go version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  go version go1.8.4 linux/amd64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="golang" scheme="https://liyuliang.cc/tags/golang/"/>
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>How Symfony create entity class from mysql database</title>
    <link href="https://liyuliang.cc/2018/01/25/How-Symfony-create-entity-class-from-mysql-database/"/>
    <id>https://liyuliang.cc/2018/01/25/How-Symfony-create-entity-class-from-mysql-database/</id>
    <published>2018-01-25T07:45:04.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat composer.json</span><br><span class="line">    ...</span><br><span class="line">    &quot;require&quot;: &#123;</span><br><span class="line">           &quot;php&quot;: &quot;&gt;=5.5.9&quot;,</span><br><span class="line">           &quot;symfony/symfony&quot;: &quot;2.8.*&quot;,</span><br><span class="line">           ...</span><br><span class="line">       &#125;,</span><br><span class="line">       </span><br><span class="line">$ mysqld -V</span><br><span class="line"> mysqld  Ver 5.7.18 for Linux on x86_64 (MySQL Community Server (GPL))</span><br></pre></td></tr></table></figure><a id="more"></a><p>In some case, you will meet a secondary development project based on mysql.It has a complete database and your new project bases on Symfony framework.<br>As you know, if there are entities mapping class will speed up your development. So this is why this tutorial exist.   </p><p>First of all: this converter doesn’t support some basic MySQL data types by default, so you have to edit your app/config/config.yml file as follows:</p><h3 id="Update-Doctrine-Configuration"><a href="#Update-Doctrine-Configuration" class="headerlink" title="Update Doctrine Configuration"></a>Update Doctrine Configuration</h3><figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">doctrine:</span></span><br><span class="line">    <span class="hljs-attr">dbal:</span></span><br><span class="line">        <span class="hljs-attr">mapping_types:</span></span><br><span class="line">            <span class="hljs-attr">enum:</span> <span class="hljs-string">string</span></span><br><span class="line">            <span class="hljs-attr">bit:</span> <span class="hljs-string">integer</span></span><br></pre></td></tr></table></figure><p>You might need to add some other types, too.<br>As Doctrine does not support any of these: </p><blockquote><p>BIT, BINARY, VARBINARY, TINYBLOB, MEDIUMBLOB, BLOB, LONGBLOB, ENUM, SET, GEOMETRY, POINT, MULTIPOINT, LINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON.</p></blockquote><h3 id="Make-sure-all-tables-have-primary-keys"><a href="#Make-sure-all-tables-have-primary-keys" class="headerlink" title="Make sure all tables have primary keys"></a>Make sure all tables have primary keys</h3><p>OK, that might sound obvious.<br>But I real had some tables without the key.</p><h3 id="Generate-the-mapping-file"><a href="#Generate-the-mapping-file" class="headerlink" title="Generate the mapping file"></a>Generate the mapping file</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php app/console doctrine:mapping:import --force AppBundle xml -vvv</span><br></pre></td></tr></table></figure><h3 id="Generate-Entities-under-directory-‘src-AppBundle-Entity’"><a href="#Generate-Entities-under-directory-‘src-AppBundle-Entity’" class="headerlink" title="Generate Entities under directory ‘src/AppBundle/Entity’"></a>Generate Entities under directory ‘src/AppBundle/Entity’</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php app/console doctrine:mapping:convert annotation ./src</span><br></pre></td></tr></table></figure><h3 id="Generate-the-Get-and-Set-method-in-entity"><a href="#Generate-the-Get-and-Set-method-in-entity" class="headerlink" title="Generate the Get and Set method in entity"></a>Generate the Get and Set method in entity</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php app/console generate:doctrine:entities AppBundle</span><br></pre></td></tr></table></figure><p>Ok, entities will all be done! </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat composer.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;require&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;quot;php&amp;quot;: &amp;quot;&amp;gt;=5.5.9&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;quot;symfony/symfony&amp;quot;: &amp;quot;2.8.*&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ mysqld -V&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; mysqld  Ver 5.7.18 for Linux on x86_64 (MySQL Community Server (GPL))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Mysql" scheme="https://liyuliang.cc/tags/Mysql/"/>
    
      <category term="Symfony" scheme="https://liyuliang.cc/tags/Symfony/"/>
    
  </entry>
  
  <entry>
    <title>Vertically Scrollable In Div Element Using CSS </title>
    <link href="https://liyuliang.cc/2018/01/19/Vertically-Scrollable-In-Div-Element-Using-CSS/"/>
    <id>https://liyuliang.cc/2018/01/19/Vertically-Scrollable-In-Div-Element-Using-CSS/</id>
    <published>2018-01-19T08:00:03.000Z</published>
    <updated>2021-06-14T14:02:02.295Z</updated>
    
    <content type="html"><![CDATA[<h3 id="My-computer-develop-environment"><a href="#My-computer-develop-environment" class="headerlink" title="My computer develop environment"></a>My computer develop environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers </span><br><span class="line">ProductName:    Mac OS X</span><br><span class="line">ProductVersion: 10.12.6</span><br><span class="line">BuildVersion:   16G29</span><br><span class="line"></span><br><span class="line">Chrome</span><br><span class="line">67.0.3396.99（64 bit）</span><br></pre></td></tr></table></figure><a id="more"></a><p>Today I want to share a method that limit div height and view its content by scrolling if content ‘s length is too much for current screen height.</p><p>First your should make sure the height you want, and set it in div <code>style</code> </p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;height:100%;&quot;&gt;</span><br></pre></td></tr></table></figure><p>Next, fixed it being vertical direction in the screen and make it can be scroll.<br>The core code is <code>overflow-y: scroll;</code></p><h4 id="At-last-the-complete-code-is-as-follow"><a href="#At-last-the-complete-code-is-as-follow" class="headerlink" title="At last, the complete code is as follow"></a>At last, the complete code is as follow</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;overflow-y: scroll; height:100%;&quot;&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;My-computer-develop-environment&quot;&gt;&lt;a href=&quot;#My-computer-develop-environment&quot; class=&quot;headerlink&quot; title=&quot;My computer develop environment&quot;&gt;&lt;/a&gt;My computer develop environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sw_vers &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductName:    Mac OS X&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ProductVersion: 10.12.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BuildVersion:   16G29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Chrome&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67.0.3396.99（64 bit）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="css" scheme="https://liyuliang.cc/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>How To Storage Session By Redis In Symfony2</title>
    <link href="https://liyuliang.cc/2018/01/17/How-To-Storage-Session-By-Redis-In-Symfony2/"/>
    <id>https://liyuliang.cc/2018/01/17/How-To-Storage-Session-By-Redis-In-Symfony2/</id>
    <published>2018-01-17T07:54:37.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-Environment"><a href="#Server-Environment" class="headerlink" title="Server Environment"></a>Server Environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 16.04.2 LTS \n \l</span><br><span class="line"></span><br><span class="line">$ redis-server --version</span><br><span class="line">Redis server v=3.0.6 sha=00000000:0 malloc=jemalloc-3.6.0 bits=64</span><br><span class="line"></span><br><span class="line">$ cat composer.json</span><br><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">       &quot;php&quot;: &quot;&gt;=5.5.9&quot;,</span><br><span class="line">       &quot;symfony/symfony&quot;: &quot;2.8.*&quot;,</span><br><span class="line">       ...</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Using-Redis-instead-of-the-default-PHP-file-storage-session"><a href="#Using-Redis-instead-of-the-default-PHP-file-storage-session" class="headerlink" title="Using Redis instead of the default PHP file storage session"></a>Using Redis instead of the default PHP file storage session</h3><p>For the first preparation, we need to have a running Redis service.</p><p>Then, installing php redis extension. This tutorial bases on the Ubuntu:16.04 system, so i will use command <code>apt install</code>  to do this.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y php-redis</span><br></pre></td></tr></table></figure></p><p>Next, find the <code>config.yml</code> in your Symfony project and register the session handler which named <code>session_handler_redis</code>.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim app/config/config.yml</span><br></pre></td></tr></table></figure><figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">framework:</span></span><br><span class="line">    <span class="hljs-string">...</span></span><br><span class="line">    <span class="hljs-attr">session:</span></span><br><span class="line">        <span class="hljs-comment"># handler_id set to null will use default session handler from php.ini</span></span><br><span class="line"><span class="hljs-comment">#        handler_id:  ~</span></span><br><span class="line">        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">session_handler_redis</span></span><br></pre></td></tr></table></figure><p>This configuration uses a new session handler to figure out the session service. </p><p>Now we can declare a Symfony Service in <code>services.yml</code>.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim app/config/services.yml</span><br></pre></td></tr></table></figure><figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-attr">services:</span></span><br><span class="line">    <span class="hljs-string">...</span></span><br><span class="line">    <span class="hljs-attr">session_handler_redis:</span></span><br><span class="line">         <span class="hljs-attr">class:</span> <span class="hljs-string">AppBundle\SessionHandler\NativeRedisSessionHandler</span></span><br><span class="line">         <span class="hljs-attr">arguments:</span> <span class="hljs-string">["%session_handler_redis_scheme%","%session_handler_redis_host%","%session_handler_redis_port%","%session_handler_redis_auth%","%session_guest_life_seconds%"]</span></span><br></pre></td></tr></table></figure><p>How can we manage the session in these new  handler <code>AppBundle\SessionHandler\NativeRedisSessionHandler</code> ?<br>There are a lot of tools on github that can do this, but I found that there is already such code in the Symfony source to help us do this.</p><p>So declare a new file named <code>NativeRedisSessionHandler</code> in your project:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim src/AppBundle/SessionHandler/NativeRedisSessionHandler.php</span><br></pre></td></tr></table></figure></p><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="hljs-comment"> * User: liang</span></span><br><span class="line"><span class="hljs-comment"> * Date: 18年01月17日</span></span><br><span class="line"><span class="hljs-comment"> * Time: 下午12:07</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">SessionHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> \<span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">NativeSessionHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * NativeRedisSessionStorage.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Driver for the redis session &lt;div id="R77EHMs" style="position: absolute; top: -1183px; left: -1358px; width: 243px;"&gt;&lt;/div&gt; save hadlers provided by the redis PHP extension.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> https://github.com/nicolasff/phpredis</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Andrej Hudec &amp;lt;pulzarraider<span class="hljs-doctag">@gmail</span>.com&amp;gt;</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Piotr Pelczar &amp;lt;me<span class="hljs-doctag">@athlan</span>.pl&amp;gt;</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NativeRedisSessionHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">NativeSessionHandler</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Constructor.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string $host Path of redis server.</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string $scheme</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> int $port</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> null $auth</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> int $saveTime</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($scheme, $host, $port = <span class="hljs-number">6379</span>, $auth = null, $saveTime = <span class="hljs-number">1440</span>)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!extension_loaded(<span class="hljs-string">'redis'</span>)) &#123;</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \RuntimeException(<span class="hljs-string">'PHP does not have "redis" session module registered'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> ($host) &#123;</span><br><span class="line"></span><br><span class="line">            $savePath = <span class="hljs-string">"&#123;$scheme&#125;://&#123;$host&#125;:&#123;$port&#125;"</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> ($auth)&#123;</span><br><span class="line">                $savePath = <span class="hljs-string">"&#123;$savePath&#125;?auth=&#123;$auth&#125;"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ini_set(<span class="hljs-string">'session.save_handler'</span>, <span class="hljs-string">'redis'</span>);</span><br><span class="line">            ini_set(<span class="hljs-string">'session.save_path'</span>, $savePath);</span><br><span class="line">            ini_set(<span class="hljs-string">'session.gc_maxlifetime'</span>, $saveTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That’s all! How simple it is!</p><h3 id="Restrict-account-logins-by-controlling-sessions"><a href="#Restrict-account-logins-by-controlling-sessions" class="headerlink" title="Restrict account logins by controlling sessions"></a>Restrict account logins by controlling sessions</h3><p>In some business contexts, user accounts should not be allowed to log in to multiple devices at the same time.<br>When an account is logged in to a new device, the old account session should be cleaned up.<br>We can maintain a new key map to control the session. For example, uniqueAccount - sessionId.</p><p>In order to control redis more conveniently, we need to install the package about redis. Here we use the <a href="https://github.com/nrk/predis" target="_blank" rel="noopener">predis</a>.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">    ...</span><br><span class="line">    &quot;snc/redis-bundle&quot;: &quot;2.1&quot;,</span><br><span class="line">    &quot;predis/predis&quot;: &quot;^1.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Then we add a new record in redis which key is user unique account and value is the sessionId after login success.<br>However, it should be noted that you need to first find and <code>delete all</code> corresponding sessionIds through the account, and then generate a new session record.</p><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@Route</span>("/login/success",name="login_success")</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loginSuccessAction</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    $CurrentUser = <span class="hljs-keyword">$this</span>-&gt;getCurrentUser();</span><br><span class="line">    $Client = <span class="hljs-keyword">new</span> \Predis\Client([</span><br><span class="line">        <span class="hljs-string">'scheme'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getParameter(<span class="hljs-string">'session_handler_redis_scheme'</span>),</span><br><span class="line">        <span class="hljs-string">'host'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getParameter(<span class="hljs-string">'session_handler_redis_host'</span>),</span><br><span class="line">        <span class="hljs-string">'port'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getParameter(<span class="hljs-string">'session_handler_redis_port'</span>),</span><br><span class="line">        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getParameter(<span class="hljs-string">'session_handler_redis_auth'</span>),</span><br><span class="line">    ]);</span><br><span class="line">    $sessionId = $Client-&gt;get($CurrentUser-&gt;account());</span><br><span class="line">    <span class="hljs-keyword">if</span> ($sessionId) &#123;</span><br><span class="line">        $Client-&gt;del([$CurrentUser-&gt;account(), $sessionId]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $session = <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-string">'session'</span>);</span><br><span class="line">    $session-&gt;start();</span><br><span class="line">    $sessionId = <span class="hljs-string">"PHPREDIS_SESSION:"</span> . $session-&gt;getId();</span><br><span class="line"></span><br><span class="line">    $Client-&gt;set($CurrentUser-&gt;account(), $sessionId);</span><br><span class="line">    $Client-&gt;expire($sessionId, <span class="hljs-keyword">$this</span>-&gt;getParameter(<span class="hljs-string">'session_user_life_seconds'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ok, after this step, repeat account login limit is completed too.</p><h3 id="Clear-Session-record-if-logout"><a href="#Clear-Session-record-if-logout" class="headerlink" title="Clear Session record if logout"></a>Clear Session record if logout</h3><p>Default logout method in Symfony is declared in the firewall configuration. When we need to customize the behavior of this account logout, we need to declare a new handler.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim app/config/security.yml</span><br></pre></td></tr></table></figure><figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-attr">security:</span></span><br><span class="line">    <span class="hljs-attr">firewalls:</span></span><br><span class="line">        <span class="hljs-string">...</span></span><br><span class="line">        <span class="hljs-attr">main:</span></span><br><span class="line">            <span class="hljs-string">...</span></span><br><span class="line">            <span class="hljs-attr">logout:</span></span><br><span class="line"><span class="hljs-comment">#                path: /logout</span></span><br><span class="line"><span class="hljs-comment">#                target: /</span></span><br><span class="line">                <span class="hljs-attr">handlers:</span> <span class="hljs-string">[app.webservice_logout_listener]</span></span><br></pre></td></tr></table></figure><p>First, we should register a new logout service<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim app/config/services.yml</span><br></pre></td></tr></table></figure></p><figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-attr">services:</span></span><br><span class="line">    <span class="hljs-string">...</span></span><br><span class="line">    <span class="hljs-attr">app.webservice_logout_listener:</span></span><br><span class="line">        <span class="hljs-attr">class:</span> <span class="hljs-string">AppBundle\Security\LogoutListener</span></span><br><span class="line">        <span class="hljs-attr">arguments:</span> <span class="hljs-string">["%session_handler_redis_scheme%","%session_handler_redis_host%","%session_handler_redis_port%","%session_handler_redis_auth%","%session_guest_life_seconds%"]</span></span><br></pre></td></tr></table></figure><p>And this listener will clear all session by current login user’s account.<br><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="hljs-comment"> * User: liyuliang</span></span><br><span class="line"><span class="hljs-comment"> * Date: 17/01/2018</span></span><br><span class="line"><span class="hljs-comment"> * Time: 3:17 PM</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">Security</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">me</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">Token</span>\<span class="hljs-title">TokenInterface</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Logout</span>\<span class="hljs-title">LogoutHandlerInterface</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogoutListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">LogoutHandlerInterface</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">use</span> <span class="hljs-title">me</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> $scheme;</span><br><span class="line">    <span class="hljs-keyword">private</span> $host;</span><br><span class="line">    <span class="hljs-keyword">private</span> $port;</span><br><span class="line">    <span class="hljs-keyword">private</span> $auth;</span><br><span class="line">    <span class="hljs-keyword">private</span> $saveTime;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($scheme, $host, $port = <span class="hljs-number">6379</span>, $auth = null, $saveTime = <span class="hljs-number">1440</span>)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;scheme = $scheme;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;host = $host;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;port = $port;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;auth = $auth;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;saveTime = $saveTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * This method is called by the LogoutListener when a user has requested</span></span><br><span class="line"><span class="hljs-comment">     * to be logged out. Usually, you would unset session variables, or remove</span></span><br><span class="line"><span class="hljs-comment">     * cookies, etc.</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> Request $request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> Response $response</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> TokenInterface $token</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span><span class="hljs-params">(Request $request, Response $response, TokenInterface $token)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        $user = $token-&gt;getUser();</span><br><span class="line"></span><br><span class="line">        $Client = <span class="hljs-keyword">new</span> \Predis\Client([</span><br><span class="line">            <span class="hljs-string">'scheme'</span> =&gt; <span class="hljs-string">'tcp'</span>,</span><br><span class="line">            <span class="hljs-string">'host'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;host,</span><br><span class="line">            <span class="hljs-string">'port'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;port,</span><br><span class="line">            <span class="hljs-string">'password'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;auth,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        $sessionId = $Client-&gt;get($user-&gt;getUsername());</span><br><span class="line">        <span class="hljs-keyword">if</span> ($sessionId) &#123;</span><br><span class="line">            $Client-&gt;del([$user-&gt;getUsername(), $sessionId]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-Environment&quot;&gt;&lt;a href=&quot;#Server-Environment&quot; class=&quot;headerlink&quot; title=&quot;Server Environment&quot;&gt;&lt;/a&gt;Server Environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 16.04.2 LTS \n \l&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ redis-server --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Redis server v=3.0.6 sha=00000000:0 malloc=jemalloc-3.6.0 bits=64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ cat composer.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;require&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;quot;php&amp;quot;: &amp;quot;&amp;gt;=5.5.9&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;quot;symfony/symfony&amp;quot;: &amp;quot;2.8.*&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
      <category term="Symfony" scheme="https://liyuliang.cc/tags/Symfony/"/>
    
      <category term="Redis" scheme="https://liyuliang.cc/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>How to install EduSoho in Ubuntu</title>
    <link href="https://liyuliang.cc/2018/01/03/How-to-install-EduSoho-in-Ubuntu/"/>
    <id>https://liyuliang.cc/2018/01/03/How-to-install-EduSoho-in-Ubuntu/</id>
    <published>2018-01-03T15:11:41.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-environment"><a href="#Server-environment" class="headerlink" title="Server environment"></a>Server environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04.5 LTS</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Install-nginx"><a href="#Install-nginx" class="headerlink" title="Install nginx"></a>Install nginx</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y nginx</span><br></pre></td></tr></table></figure><h3 id="Config-Nginx"><a href="#Config-Nginx" class="headerlink" title="Config Nginx"></a>Config Nginx</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>Add this in http{} field<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client_max_body_size 1024M;</span><br></pre></td></tr></table></figure></p><h3 id="Install-mysql"><a href="#Install-mysql" class="headerlink" title="Install mysql"></a>Install mysql</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y mysql-server</span><br></pre></td></tr></table></figure><h3 id="Create-database"><a href="#Create-database" class="headerlink" title="Create database"></a>Create database</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -uroot -p</span><br></pre></td></tr></table></figure><h3 id="Create-edusoho-database-add-database-user"><a href="#Create-edusoho-database-add-database-user" class="headerlink" title="Create edusoho database, add database user"></a>Create edusoho database, add database user</h3><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> <span class="hljs-string">`edusoho`</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 ; </span><br><span class="line"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">`edusoho`</span>.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'esuser'</span>@<span class="hljs-string">'localhost'</span> <span class="hljs-keyword">IDENTIFIED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">'edusoho'</span>;</span><br></pre></td></tr></table></figure><p>username: esuser<br>password: edusoho</p><h3 id="Install-PHP"><a href="#Install-PHP" class="headerlink" title="Install PHP"></a>Install PHP</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get -y install php5 php5-cli php5-curl php5-fpm php5-intl php5-mcrypt php5-mysqlnd php5-gd</span><br></pre></td></tr></table></figure><h3 id="Change-PHP-file-upload-size-limit"><a href="#Change-PHP-file-upload-size-limit" class="headerlink" title="Change PHP file upload size limit"></a>Change PHP file upload size limit</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/php5/fpm/php.ini</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post_max_size = 1024M </span><br><span class="line">memory_limit = 1024M</span><br><span class="line">upload_max_filesize = 1024M</span><br></pre></td></tr></table></figure><h3 id="Config-PHP-FPM"><a href="#Config-PHP-FPM" class="headerlink" title="Config PHP-FPM"></a>Config PHP-FPM</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/php5/fpm/pool.d/www.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;listen.owner = www-data</span><br><span class="line">;listen.group = www-data</span><br><span class="line">;listen.mode = 0660</span><br></pre></td></tr></table></figure><p>Remove the semicolon then restart PHP-FPM<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/php5-fpm restart</span><br></pre></td></tr></table></figure></p><h3 id="Install-EduSoho"><a href="#Install-EduSoho" class="headerlink" title="Install EduSoho"></a>Install EduSoho</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -s</span><br><span class="line">$ mkdir -p /var/www</span><br><span class="line">$ cd /var/www</span><br><span class="line">$ wget http://download.edusoho.com/edusoho-8.2.5.tar.gz</span><br><span class="line">$ tar -zxvf edusoho-8.2.5.tar.gz</span><br><span class="line">$ chown www-data:www-data edusoho/ -Rf</span><br></pre></td></tr></table></figure><p>If this zip package can not download, please visit the edusoho home page for it.</p><h3 id="Configure-nginx-virtual-host"><a href="#Configure-nginx-virtual-host" class="headerlink" title="Configure nginx virtual host"></a>Configure nginx virtual host</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/nginx/sites-enabled/default</span><br></pre></td></tr></table></figure><p>Replace all its contents with following </p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line"></span><br><span class="line">    root /var/www/edusoho/web;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/example.com.access.log;</span><br><span class="line">    error_log /var/log/nginx/example.com.error.log;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        index app.php;</span><br><span class="line">        try_files $uri @rewriteapp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location @rewriteapp &#123;</span><br><span class="line">        rewrite ^(.*)$ /app.php/$1 last;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^/udisk &#123;</span><br><span class="line">        internal;</span><br><span class="line">        root /var/www/edusoho/app/data/;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^/(app|app_dev)\.php(/|$) &#123;</span><br><span class="line">        fastcgi_pass   unix:/var/run/php5-fpm.sock;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.*)$;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br><span class="line">        fastcgi_param  HTTPS              off;</span><br><span class="line">        fastcgi_param HTTP_X-Sendfile-Type X-Accel-Redirect;</span><br><span class="line">        fastcgi_param HTTP_X-Accel-Mapping /udisk=/var/www/edusoho/app/data/udisk;</span><br><span class="line">        fastcgi_buffer_size 128k;</span><br><span class="line">        fastcgi_buffers 8 128k;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* \.(jpg|jpeg|gif|png|ico|swf)$ &#123;</span><br><span class="line">        # three year expire time</span><br><span class="line">        expires 3y;</span><br><span class="line"></span><br><span class="line">        # close log record</span><br><span class="line">        access_log off;</span><br><span class="line"></span><br><span class="line">        # close gzip compression to reduce CPU pressure because the picture compression rate is low</span><br><span class="line">        gzip off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* \.(css|js)$ &#123;</span><br><span class="line">        access_log off;</span><br><span class="line">        expires 3y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # forbidden to access user upload file directory for security</span><br><span class="line">    location ~ ^/files/.*\.(php|php5)$ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass   unix:/var/run/php5-fpm.sock;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.*)$;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br><span class="line">        fastcgi_param  HTTPS              off;</span><br><span class="line">        fastcgi_param  HTTP_PROXY         &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Restart-nginx"><a href="#Restart-nginx" class="headerlink" title="Restart nginx"></a>Restart nginx</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/nginx restart</span><br></pre></td></tr></table></figure><p>Open you browse to visit <a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-environment&quot;&gt;&lt;a href=&quot;#Server-environment&quot; class=&quot;headerlink&quot; title=&quot;Server environment&quot;&gt;&lt;/a&gt;Server environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ubuntu 14.04.5 LTS&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>PHP Singleton Mode</title>
    <link href="https://liyuliang.cc/2018/01/03/PHP-Singleton-Mode/"/>
    <id>https://liyuliang.cc/2018/01/03/PHP-Singleton-Mode/</id>
    <published>2018-01-03T08:56:12.000Z</published>
    <updated>2021-06-14T14:02:02.295Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-environment"><a href="#Server-environment" class="headerlink" title="Server environment"></a>Server environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">  Ubuntu 16.04.2 LTS</span><br><span class="line">  </span><br><span class="line">$ php -v</span><br><span class="line">  PHP 7.0.22-0ubuntu0.16.04.1 (cli) ( NTS )</span><br></pre></td></tr></table></figure><a id="more"></a><p>The Real One and Modern way to make Singleton Pattern is:</p><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">Class</span> <span class="hljs-title">Singleton</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Singleton constructor.</span></span><br><span class="line"><span class="hljs-comment">     * Make constructor private. so nobody can call "new Class".</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Make clone magic method private. so nobody can clone instance.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Make sleep magic method private. so nobody can serialize instance.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Make wakeup magic method private. so nobody can unserialize instance.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Call this method to get singleton</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> static</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Instance</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">static</span> $instance = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> ($instance === <span class="hljs-keyword">false</span>) &#123;</span><br><span class="line">            $instance = <span class="hljs-keyword">new</span> <span class="hljs-keyword">static</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> $instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So now you can use it like.</p><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Database</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Singleton</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">protected</span> $label;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLabel</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> mixed $label</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setLabel</span><span class="hljs-params">($label)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;label = $label;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Test it<br><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$database = Database::Instance();</span><br><span class="line">$database-&gt;setLabel(<span class="hljs-string">"Liang-app"</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">echo</span> $database-&gt;getLabel() . PHP_EOL;   <span class="hljs-comment">//Liang-app</span></span><br><span class="line"></span><br><span class="line">$other_db = Database::Instance();</span><br><span class="line"><span class="hljs-keyword">echo</span> $other_db-&gt;getLabel() . PHP_EOL;   <span class="hljs-comment">//Liang-app</span></span><br><span class="line"></span><br><span class="line">$other_db-&gt;setLabel(<span class="hljs-string">"Liang-app-2"</span>);</span><br><span class="line"><span class="hljs-keyword">echo</span> $database-&gt;getLabel() . PHP_EOL;   <span class="hljs-comment">//Liang-app-2</span></span><br><span class="line"><span class="hljs-keyword">echo</span> $other_db-&gt;getLabel() . PHP_EOL;   <span class="hljs-comment">//Liang-app-2</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-environment&quot;&gt;&lt;a href=&quot;#Server-environment&quot; class=&quot;headerlink&quot; title=&quot;Server environment&quot;&gt;&lt;/a&gt;Server environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Ubuntu 16.04.2 LTS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ php -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PHP 7.0.22-0ubuntu0.16.04.1 (cli) ( NTS )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="https://liyuliang.cc/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Fail2ban Pass Mysql Remote Login through</title>
    <link href="https://liyuliang.cc/2018/01/01/Fail2ban-Pass-Mysql-Remote-Login-through/"/>
    <id>https://liyuliang.cc/2018/01/01/Fail2ban-Pass-Mysql-Remote-Login-through/</id>
    <published>2018-01-01T04:53:01.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-environment"><a href="#Server-environment" class="headerlink" title="Server environment"></a>Server environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">  Ubuntu 14.04.5 LTS</span><br><span class="line"></span><br><span class="line">$ fail2ban-server -V</span><br><span class="line">Fail2Ban v0.8.11</span><br></pre></td></tr></table></figure><a id="more"></a><p>Recently, I found that there are many ssh attack in the auth.log.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat /var/log/auth.log | grep ssh2</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Jan  1 01:20:49 app sshd[22438]: Failed password for root from 59.55.140.173 port 16421 ssh2</span><br><span class="line">Jan  1 01:27:22 app sshd[22440]: Failed password for invalid user snort from 91.121.112.123 port 33773 ssh2</span><br><span class="line">Jan  1 01:58:52 app sshd[22459]: Failed password for invalid user admin from 196.219.96.116 port 53758 ssh2</span><br><span class="line">Jan  1 01:59:01 app sshd[22461]: Failed password for invalid user admin from 14.170.244.58 port 42785 ssh2</span><br><span class="line">Jan  1 02:05:25 app sshd[22466]: Failed password for invalid user vmail from 5.135.161.94 port 60876 ssh2</span><br><span class="line">Jan  1 02:08:04 app sshd[22468]: Failed password for invalid user test9 from 5.135.161.94 port 55094 ssh2</span><br><span class="line">Jan  1 02:10:52 app sshd[22483]: Failed password for invalid user oracle from 5.135.161.94 port 49413 ssh2</span><br></pre></td></tr></table></figure><p>So I decided to use <code>fail2ban</code> with <code>iptables</code> to limit this part of ip address to access.</p><h3 id="Check-The-Iptables"><a href="#Check-The-Iptables" class="headerlink" title="Check The Iptables"></a>Check The Iptables</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -nvL</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT 1850K packets, 353M bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 1786K packets, 571M bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br></pre></td></tr></table></figure><h3 id="Add-Iptables-Rules"><a href="#Add-Iptables-Rules" class="headerlink" title="Add Iptables Rules"></a>Add Iptables Rules</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/iptables.my.rules</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">*filter</span><br><span class="line"></span><br><span class="line"># Allows all loopback (lo0) traffic and drop all traffic to 127/8 that doesn&apos;t use lo0</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT</span><br><span class="line"></span><br><span class="line"># Accepts all established inbound connections</span><br><span class="line">-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"># Allows all outbound traffic</span><br><span class="line"># You could modify this to only allow certain traffic</span><br><span class="line">-A OUTPUT -j ACCEPT</span><br><span class="line"></span><br><span class="line"># Allows HTTP and HTTPS connections from anywhere (the normal ports for websites)</span><br><span class="line">-A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line"></span><br><span class="line"># Allows SSH connections </span><br><span class="line"># The --dport number is the same as in /etc/ssh/sshd_config</span><br><span class="line">-A INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line"># Allows Mysql connections</span><br><span class="line">-A INPUT -p tcp --dport 3306 -j ACCEPT</span><br><span class="line"></span><br><span class="line"># Now you should read up on iptables rules and consider whether ssh access </span><br><span class="line"># for everyone is really desired. Most likely you will only allow access from certain IPs.</span><br><span class="line"></span><br><span class="line"># Allow ping</span><br><span class="line">#  note that blocking other types of icmp packets is considered a bad idea by some</span><br><span class="line">#  remove -m icmp --icmp-type 8 from this line to allow all kinds of icmp:</span><br><span class="line">#  https://security.stackexchange.com/questions/22711</span><br><span class="line">-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT</span><br><span class="line"></span><br><span class="line"># log iptables denied calls (access via &apos;dmesg&apos; command)</span><br><span class="line">-A INPUT -m limit --limit 5/min -j LOG --log-prefix &quot;iptables denied: &quot; --log-level 7</span><br><span class="line"></span><br><span class="line"># Reject all other inbound - default deny unless explicitly allowed policy:</span><br><span class="line">-A INPUT -j REJECT</span><br><span class="line">-A FORWARD -j REJECT</span><br><span class="line"></span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure><p>You can follow this example to add other applications port access like this Mysql(3306) port.</p><h3 id="Enable-This-Rules"><a href="#Enable-This-Rules" class="headerlink" title="Enable This Rules"></a>Enable This Rules</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables-restore &lt; /etc/iptables.my.rules</span><br></pre></td></tr></table></figure><h3 id="Save-This-Rules"><a href="#Save-This-Rules" class="headerlink" title="Save This Rules"></a>Save This Rules</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables-save &gt; /etc/iptables.up.rules</span><br></pre></td></tr></table></figure><h3 id="Auto-Start-After-Boot"><a href="#Auto-Start-After-Boot" class="headerlink" title="Auto Start After Boot"></a>Auto Start After Boot</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/network/if-pre-up.d/iptables</span><br></pre></td></tr></table></figure><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">/sbin/iptables-restore &lt; /etc/iptables.up.rules</span><br></pre></td></tr></table></figure><p>Add file execution permission<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod +x /etc/network/if-pre-up.d/iptables</span><br></pre></td></tr></table></figure></p><h3 id="Install-Fail2ban"><a href="#Install-Fail2ban" class="headerlink" title="Install Fail2ban"></a>Install Fail2ban</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install -y fail2ban</span><br></pre></td></tr></table></figure><h3 id="Copy-A-Jail-Config-file"><a href="#Copy-A-Jail-Config-file" class="headerlink" title="Copy A Jail Config file"></a>Copy A Jail Config file</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /etc/fail2ban  </span><br><span class="line">$ cp jail.conf jail.local</span><br></pre></td></tr></table></figure><h3 id="Change-This-Configuration"><a href="#Change-This-Configuration" class="headerlink" title="Change This Configuration"></a>Change This Configuration</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"></span><br><span class="line">### Continuous access in 600 seconds</span><br><span class="line">findtime = 600</span><br><span class="line"></span><br><span class="line">### Entry wrong password 2 times.</span><br><span class="line">maxretry = 2</span><br><span class="line"></span><br><span class="line">### Block access for 1 days.</span><br><span class="line">bantime  = 36000000</span><br><span class="line"></span><br><span class="line">backend = polling</span><br><span class="line">...</span><br><span class="line"># Choose default action.  To change, just override value of &apos;action&apos; with the</span><br><span class="line"># interpolation to the chosen action shortcut (e.g.  action_mw, action_mwl, etc) in jail.local</span><br><span class="line"># globally (section [DEFAULT]) or per specific section</span><br><span class="line">#action = %(action_)s</span><br><span class="line"></span><br><span class="line">action = iptables[name=SSH, port=ssh, protocol=tcp]</span><br></pre></td></tr></table></figure><h3 id="Start-Fail2ban"><a href="#Start-Fail2ban" class="headerlink" title="Start Fail2ban"></a>Start Fail2ban</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service fail2ban restart</span><br></pre></td></tr></table></figure><h3 id="Check-the-log-print"><a href="#Check-the-log-print" class="headerlink" title="Check the log print"></a>Check the log print</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo tail -f /var/log/fail2ban.log</span><br><span class="line"></span><br><span class="line">2018-01-01 04:44:39,853 fail2ban.jail   : INFO   Creating new jail &apos;ssh&apos;</span><br><span class="line">2018-01-01 04:44:39,853 fail2ban.jail   : INFO   Jail &apos;ssh&apos; uses poller</span><br><span class="line">2018-01-01 04:44:39,868 fail2ban.jail   : INFO   Initiated &apos;polling&apos; backend</span><br><span class="line">2018-01-01 04:44:39,869 fail2ban.filter : INFO   Added logfile = /var/log/auth.log</span><br><span class="line">2018-01-01 04:44:39,870 fail2ban.filter : INFO   Set maxRetry = 6</span><br><span class="line">2018-01-01 04:44:39,871 fail2ban.filter : INFO   Set findtime = 600</span><br><span class="line">2018-01-01 04:44:39,871 fail2ban.actions: INFO   Set banTime = 36000000</span><br><span class="line">2018-01-01 04:44:39,919 fail2ban.jail   : INFO   Jail &apos;ssh&apos; started</span><br><span class="line">2018-01-01 04:45:10,981 fail2ban.actions: WARNING [ssh] Ban 118.212.143.43</span><br><span class="line">2018-01-01 04:52:52,562 fail2ban.actions: WARNING [ssh] Ban 220.191.194.22</span><br></pre></td></tr></table></figure><h3 id="Check-Result-In-iptables"><a href="#Check-Result-In-iptables" class="headerlink" title="Check Result In iptables"></a>Check Result In iptables</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -nvL</span><br><span class="line">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line"> 8468  549K fail2ban-SSH  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22</span><br><span class="line">    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           </span><br><span class="line">    0     0 REJECT     all  --  !lo    *       0.0.0.0/0            127.0.0.0/8          reject-with icmp-port-unreachable</span><br><span class="line">31873   13M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED</span><br><span class="line">    3   140 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80</span><br><span class="line">  498 33053 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443</span><br><span class="line">   13   764 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:22</span><br><span class="line">   29  1740 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:3306</span><br><span class="line">    1    84 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 8</span><br><span class="line">  376  114K LOG        all  --  *      *       0.0.0.0/0            0.0.0.0/0            limit: avg 5/min burst 5 LOG flags 0 level 7 prefix &quot;iptables denied: &quot;</span><br><span class="line"> 1813  442K REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">31767   20M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain fail2ban-SSH (1 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">   10   988 REJECT     all  --  *      *       220.191.194.22       0.0.0.0/0            reject-with icmp-port-unreachable</span><br><span class="line">  369 22140 REJECT     all  --  *      *       118.212.143.43       0.0.0.0/0            reject-with icmp-port-unreachable</span><br><span class="line"> 8089  525K RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br></pre></td></tr></table></figure><p>You can see the part <code>Chain fail2ban-SSH (1 references)</code>, the fail2ban is working and filter 2 ip attack by iptables.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-environment&quot;&gt;&lt;a href=&quot;#Server-environment&quot; class=&quot;headerlink&quot; title=&quot;Server environment&quot;&gt;&lt;/a&gt;Server environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Ubuntu 14.04.5 LTS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ fail2ban-server -V&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fail2Ban v0.8.11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
      <category term="iptable" scheme="https://liyuliang.cc/tags/iptable/"/>
    
  </entry>
  
  <entry>
    <title>Linux upload file to Baidu cloud disk</title>
    <link href="https://liyuliang.cc/2017/12/15/Linux-upload-file-to-Baidu-cloud-disk/"/>
    <id>https://liyuliang.cc/2017/12/15/Linux-upload-file-to-Baidu-cloud-disk/</id>
    <published>2017-12-15T13:27:32.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-environment"><a href="#Server-environment" class="headerlink" title="Server environment"></a>Server environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">  Ubuntu 16.04.2 LTS</span><br><span class="line"></span><br><span class="line">$ pip -V</span><br><span class="line">  pip 9.0.1 from /usr/local/lib/python2.7/dist-packages (python 2.7)</span><br><span class="line">  </span><br><span class="line">$ php -v</span><br><span class="line">  PHP 7.0.22-0ubuntu0.16.04.1 (cli) ( NTS )</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Install-bypy"><a href="#Install-bypy" class="headerlink" title="Install bypy"></a>Install bypy</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install requests bypy</span><br></pre></td></tr></table></figure><h3 id="Authorized-Login"><a href="#Authorized-Login" class="headerlink" title="Authorized Login"></a>Authorized Login</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bypy info</span><br><span class="line">Please visit:</span><br><span class="line">https://openapi.baidu.com/oauth/2.0/authorize?scope=basic+netdisk&amp;redirect_uri=oob&amp;response_type=code&amp;client_id=q8WE4EpCsau1oS0MplgMKNBn</span><br><span class="line">And authorize this app</span><br><span class="line">Paste the Authorization Code here within 10 minutes.</span><br><span class="line">Press [Enter] when you are done</span><br></pre></td></tr></table></figure><p>Visit the url then copy the code in terminal and entry<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bc773b9b3884019d284b59c21fccf449</span><br></pre></td></tr></table></figure></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Authorizing, please be patient, it may take upto None seconds...</span><br><span class="line">Authorizing/refreshing with the OpenShift server ...</span><br><span class="line">OpenShift server failed, authorizing/refreshing with the Heroku server ...</span><br><span class="line">Successfully authorized</span><br><span class="line">Quota: 2.008TB</span><br><span class="line">Used: 192.089GB</span><br></pre></td></tr></table></figure><p>Authorized success.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bypy list</span><br><span class="line">/apps/bypy ($t $f $s $m $d):</span><br></pre></td></tr></table></figure><p>Limited by Baidu PCS api, files just can be accessed under the /apps/bypy directory in Baidu cloud disk    </p><h3 id="Upload-to-cloud-disk"><a href="#Upload-to-cloud-disk" class="headerlink" title="Upload to cloud disk"></a>Upload to cloud disk</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/data/</span><br><span class="line">$ bypy upload</span><br><span class="line">[____________________] 0% (85.2MB/1.3GB)</span><br></pre></td></tr></table></figure><p>All files under the data directory are uploading.</p><h3 id="Download-file-from-cloud-disk"><a href="#Download-file-from-cloud-disk" class="headerlink" title="Download file from cloud disk"></a>Download file from cloud disk</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bypy downdir</span><br></pre></td></tr></table></figure><p>Files under the directory /apps/bypy will be downloaded now.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-environment&quot;&gt;&lt;a href=&quot;#Server-environment&quot; class=&quot;headerlink&quot; title=&quot;Server environment&quot;&gt;&lt;/a&gt;Server environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Ubuntu 16.04.2 LTS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ pip -V&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pip 9.0.1 from /usr/local/lib/python2.7/dist-packages (python 2.7)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ php -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PHP 7.0.22-0ubuntu0.16.04.1 (cli) ( NTS )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
      <category term="Baidu" scheme="https://liyuliang.cc/tags/Baidu/"/>
    
      <category term="CloudDisk" scheme="https://liyuliang.cc/tags/CloudDisk/"/>
    
  </entry>
  
  <entry>
    <title>Build Google Mirror By Nginx</title>
    <link href="https://liyuliang.cc/2017/12/15/Build-Google-Mirror-By-Nginx/"/>
    <id>https://liyuliang.cc/2017/12/15/Build-Google-Mirror-By-Nginx/</id>
    <published>2017-12-15T10:55:22.000Z</published>
    <updated>2021-06-14T14:02:02.291Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Server-Environment"><a href="#Server-Environment" class="headerlink" title="Server Environment"></a>Server Environment</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">  Ubuntu 14.04.4 LTS</span><br><span class="line">$ nginx -v</span><br><span class="line">  nginx version: nginx/1.4.6 (Ubuntu)</span><br></pre></td></tr></table></figure><a id="more"></a><p>A simple demo to build a google mirror.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/nginx/sites-enabled/google.conf</span><br><span class="line"> </span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  _;</span><br><span class="line"> </span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass https://www.google.com.hk;</span><br><span class="line">        proxy_connect_timeout 120;</span><br><span class="line">        proxy_read_timeout 600;</span><br><span class="line">        proxy_send_timeout 600;</span><br><span class="line"> </span><br><span class="line">        send_timeout 600;</span><br><span class="line">        proxy_redirect    off;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">           # proxy_set_header Host $host;</span><br><span class="line"> </span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Server-Environment&quot;&gt;&lt;a href=&quot;#Server-Environment&quot; class=&quot;headerlink&quot; title=&quot;Server Environment&quot;&gt;&lt;/a&gt;Server Environment&lt;/h3&gt;&lt;figure class=&quot;highlight plain hljs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cat /etc/issue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Ubuntu 14.04.4 LTS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ nginx -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  nginx version: nginx/1.4.6 (Ubuntu)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ubuntu" scheme="https://liyuliang.cc/tags/Ubuntu/"/>
    
      <category term="nginx" scheme="https://liyuliang.cc/tags/nginx/"/>
    
      <category term="proxy" scheme="https://liyuliang.cc/tags/proxy/"/>
    
  </entry>
  
</feed>
